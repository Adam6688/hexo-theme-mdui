<script type="text/ls-javascript" id="global-script">
  /* swipable drawer */
  (function () {
    var drawer = new mdui.Drawer('#drawer', {swipe: true});
  })();

  /* appbar button */
  (function() {
    var drawer = document.querySelector('#drawer')
    var drawerBtn = document.querySelector('.drawer-button')

    drawer.addEventListener('open.mdui.drawer', function (e) {
      drawerBtn.classList.add('back')
    })
    drawer.addEventListener('close.mdui.drawer', function (e) {
      drawerBtn.classList.remove('back')
    })
  })();

  /* drawer */
  document.querySelector('#drawer-button').addEventListener('click', function (e) {
      this.classList.toggle('pages');
      document.querySelector('#drawer').classList.toggle('pages');
  })
</script>

<%- partial('js/drawer_content_hide') %>

<% // js in post and custom page
  if (!is_home() && !is_archive() && !is_year() && !is_month() && !is_category() && !is_tag() && page.path !== 'search/index.html' && page.layout !== 'galleries' && page.layout !== 'gallery' && page.layout !== 'friends')
{ %>
  <%- partial('js/now/appbar') %>
  <%- partial('js/toc') %>
  <%- partial('js/post_lg') %>
  <%- partial('js/toc_hidden') %>
  <%- partial('js/content_warning') %>
  <% //- partial('js/donte_judge')
  %>

  <% if (page.mathjax === true) { %>
    <!-- MathJax Load-->
    <%- partial('../../_widget/post_mathjax') %>
  <% } %>

<% } %>

<% // archive page parallax background
  if (is_archive())
{ %>
  <script>
    window.addEventListener("scroll", function(){
       document.querySelector('#archives .bg .mdui-img-fluid.mdui-img-rounded')
        .style.transform = 'translateY(' + document.body.scrollTop * 0.4 + 'px)';
    })
  </script>
  <% if (theme.about_me === true) { %>
    <script type="text/ls-javascript" id="about-me-dialog-script">
      /* aboutme dialog */
      (function() {
        var collapseItems = document.querySelectorAll('div.mdui-collapse-item')

        for (i = 0; i < collapseItems.length; i++) {
          collapseItems[i].addEventListener("click", toggleText);
        }

        function toggleText() {
          this.addEventListener('open.mdui.collapse', function() {
              this.classList.add('hide-more');
              this.classList.remove('hide-less');
          });
          this.addEventListener('close.mdui.collapse', function() {
            this.classList.remove('hide-more');
            this.classList.add('hide-less');
          });
        }

        var cardFlag = false;
        var aboutmeDialog = document.querySelector('div#aboutmeDialog')
        var aboutmeAppbar = document.querySelector('div#aboutmeAppbar')

        aboutmeDialog.addEventListener('scroll', function() {
          var cardLocation = document.querySelector('div#cardLocation').getBoundingClientRect().top
          if (!cardFlag && cardLocation < 0) {
            aboutmeAppbar.classList.add('style-fix');
            cardFlag = true;
          } else if (cardFlag && cardLocation >= 0) {
            aboutmeAppbar.classList.remove('style-fix');
            cardFlag = false;
          };
        });

        var cardLocation = document.querySelector('div#cardLocation').getBoundingClientRect().top

        aboutmeDialog.addEventListener('open.mdui.dialog', function() {
          if (!cardFlag && cardLocation < 0) {
            aboutmeAppbar.classList.add('style-fix');
            cardFlag = true;
          };
        });
        aboutmeDialog.addEventListener('close.mdui.dialog', function() {
          if (cardFlag && cardLocation < 0) {
            aboutmeAppbar.classList.remove('style-fix');
            cardFlag = false;
          };
        });
      })();
    </script>
  <% } %>
<% } %>

<% // index toolbar search
  if (is_home() && theme.appbar.search === true)
{ %>
  <%- partial('js/now/index_search') %>
<% } %>

<% if (!is_home() && !is_archive() && page.layout !== 'galleries' && page.layout !== 'gallery' && page.layout !== 'friends' && theme.appbar.search === true) { %>
  <%- partial('js/now/appbar_search') %>
<% } %>

<% // appbar style change in category, tag ,year posts page
  if (is_category() || is_tag() || is_year())
{ %>
  <%- partial('js/styleChanging') %>
<% } %>

<% // js in search page
  if (page.path === 'search/index.html' && theme.appbar.search === true)
{ %>
  <%- partial('../../_widget/js/search/now')%>
<% } %>

<% // to top fab
  if (is_home() || is_archive() || is_year() || is_category() || is_tag()) { %>
  <%- partial('js/to_top')%>
<% } %>

<% // js in gallery, galleries
  if (page.layout === 'gallery' || page.layout === 'galleries') { %>
  <script type="text/ls-javascript" id="back-button-script">
    /* back button */
    (function() {
      document.querySelector('button[back]').addEventListener('click', function() {
          window.history.back();
      })
    })();
  </script>
<% } %>

<% if (theme.index.notification === true) { %>
  <%- partial('js/notification')%>
<% } %>
