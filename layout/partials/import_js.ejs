<!-- Import JS -->
<% if(theme.vendors.outdatedbrowser_min_js) { %>
  <script type="text/javascript" src="<%= theme.vendors.outdatedbrowser_min_js %>"></script>
<% } else { %>
  <%- js("js/outdatedbrowser.min") %>
<% } %>
<script>
//event listener: DOM ready
function addLoadEvent(func) {
  var oldonload = window.onload;
  if (typeof window.onload != 'function') {
      window.onload = func;
  } else {
      window.onload = function() {
          if (oldonload) {
              oldonload();
          }
          func();
      }
  }
}
//call plugin function after DOM ready
addLoadEvent(function(){
  outdatedBrowser({
      bgColor: '#f25648',
      color: '#ffffff',
      lowerThan: 'transform',
      languagePath: ''
  })
});
</script>

<% if(theme.vendors.js_min_js) { %>
  <script type="text/javascript" src="<%= theme.vendors.js_min_js %>"></script>
<% } else { %>
  <%- js("js/js") %>
<% } %>

<% if (theme.service_woker === true || theme.service_woker === 'pwa') { %>
  <script>
    if ('serviceWorker' in navigator) {
     navigator.serviceWorker.register('/sw.js');
    }
  </script>
<% } %>

<% if (theme.busuanzi !== false) { %>
  <script src="<%= theme.busuanzi.busuanzi_pure_mini_js %>"></script>
<% } %>
<% if (is_home() || is_archive() || is_year() || is_month() || is_category() || is_tag()) { %>
  <script type="text/javascript">
    <% if (!is_archive() || is_year()) { %>
      (function() {
        var items = document.querySelectorAll("#content-list .content-item");
        var list = document.querySelector(".posts-container");
        var columns = [document.createElement("div"), document.createElement("div"), document.createElement("div")];
        var level = 4;
        var sm = 1;
        var column1Width = 1024;
        var column2Width = 1400;
        list.innerHTML = "";
        function getColumnNums() {
          if (document.body.clientWidth <= column1Width) {
            return 1
          }
          if (document.body.clientWidth <= column2Width) {
            return 2
          }
          return 3
        }
        function updateList() {
          var ColumnNums = getColumnNums();
          if (level == ColumnNums) return;
          level = ColumnNums;
          list.setAttribute("class", "column-" + ColumnNums + " posts-container")
          Array.prototype.forEach.call(items, function(value, index) {
            var to = index % ColumnNums;
            columns[to].appendChild(value);
          })
          columns.forEach(function(value) {
            list.appendChild(value)
          })
        }
        window.addEventListener("resize", updateList);
        updateList();
      })()
    <% } %>
  </script>
<% } %>
<% if (!is_home()) { %>
  <script type="text/javascript">
    $$(document).on('click', '.back-button', function() {
        window.history.back();
    });
  </script>
<% } %>
<% if (!is_post() && theme.translations.snackbar && page.total > 1) { %>
  <script type="text/javascript">
    $$(document).on('click', 'a[name="snackbar"]', function () {
      mdui.snackbar({
        message: '<%= theme.translations.snackbar %>',
        timeout: 1000
      });
    });
  </script>
<% } %>
<% if (!is_home() && !is_archive() && !is_year() && !is_month() && !is_category() && !is_tag()) { %>
  <script type="text/javascript">
    $$(document).ready(function(){
      if($$(".toc").length == 0 || $$("#card-toc").length == 0)
      {
        $$("#button-toc").addClass("mdui-hidden");
        $$("#card-toc").addClass("mdui-hidden");
        $$("#blog-post").addClass("no-toc")
      };
    });
    window.addEventListener("load",function(){
        function doWork(){
            listens.forEach(function(value,index){
                value[1]();
                $$(value[0]).removeClass("mdui-list-item-active");
            })
            $$((listens[listens.reduce(function(r,v,index){
                if(v[2] == true){
                    return index;
                }
                else return r;
            },undefined)] || [])[0]).addClass("mdui-list-item-active");

        }
        var listens = [];
        var links = document.querySelectorAll(".post-toc-link");
        Array.prototype.forEach.call(links,function(value,index){
            var id = (value.getAttribute("href") || "#").slice(1);
            var element = document.getElementById(id);
            listens.push([value,function(){
                var readed = false;
                var scrollTop = (document.documentElement && document.documentElement.scrollTop) || document.body.scrollTop;
                if ($$(element).offset().top <= scrollTop + $$(element).height() + 64) {
                    readed = true;
                } else {
                    readed = false;
                }
                listens[index][2] = readed;
            },false])
        })
        doWork();
        window.addEventListener("scroll",doWork)
    })
  </script>

  <% if (page.mathjax) { %>
    <!-- MathJax Load-->
    <%- partial('../widget/mathjax') %>
  <% } %>
<% } %>

<script>
  $$(document).on('open.mdui.dialog', '.mdui-dialog', function() {
      $$('html').css('overflow-y', 'hidden');
      $$('body').removeClass('drawer-overlay-none');
  });
  $$(document).on('close.mdui.dialog', '.mdui-dialog', function() {
      $$('html').css('overflow-y', 'auto');
      $$('body').addClass('drawer-overlay-none');
  });
  $$(function () {
    smoothScroll.init({
      selector: 'a',
      offset: 60
    });
  });
</script>

<% if (theme.about_me === true && is_archive()) { %>
  <script>
    $$(document).on('open.mdui.collapse', '.mdui-collapse-item', function() {
        $$(this).addClass('hide-more');
        $$(this).removeClass('hide-less');
    });
    $$(document).on('close.mdui.collapse', '#aboutmeCollapse', function() {
      $$(this).removeClass('hide-more');
      $$(this).addClass('hide-less');
    });
    var card_flag = false;
    $$('#aboutmeDialog').on('scroll', function() {
      if (!card_flag && $$('#cardLocation').position().top < 0) {
        $$('#aboutmeAppbar').removeClass('mdui-hidden');
        card_flag = true;
      } else if (card_flag && $$('#cardLocation').position().top > 0) {
        $$('#aboutmeAppbar').addClass('mdui-hidden');
        card_flag = false;
      };
    });
  </script>
<% } %>

<% if (is_category() || is_tag() || is_year()) { %>
  <script>
    var postsCount = $$('.posts-container div').children('.content-item').length;
    if (postsCount === 1) {
      var postsText = '<%= theme.translations.archive.post %>';
    } else if (postsCount > 1) {
      var postsText = '<%= theme.translations.archive.posts %>';
    }
    $$('#postsCount').text(postsCount + ' ' + postsText);
    function styleChanging() {
      var hide = new mdui.Headroom('#blog-appbar');
      var windowWidth = window.innerWidth, toLeftWidth = 860;
      if (windowWidth < toLeftWidth) {
        hide.enable();
      } else {
        hide.disable();
      }
    };
    styleChanging();
    var content_flag = false;
    $$(window).on('scroll', function() {
      var scrollTop = (document.documentElement && document.documentElement.scrollTop) || document.body.scrollTop;
      var contentLocation = $$('#contentLocation').offset().top - scrollTop - 56;
      if (!content_flag && contentLocation < 0 && window.innerWidth < 860) {
        $$('#blog-appbar').addClass('style-fix');
        $$('body').removeClass('style-fix');
        content_flag = true;
      } else if (content_flag && contentLocation > 0 && window.innerWidth < 860) {
        $$('#blog-appbar').removeClass('style-fix');
        $$('body').addClass('style-fix');
        content_flag = false;
      };
    });
  </script>
<% } %>

<% if (is_post() || is_category() || is_tag() || is_year()) { %>
  <script>
    $$('.toTop').on('click', function () {
      $$('#toTop').trigger('click');
    });
  </script>
<% } %>

<% if (page.path === 'search/index.html') { %>
  <script>
    $$('#search-input').on('click', function () {
      $$('#toTop').trigger('click');
    });
  </script>
<% } %>

<!-- Custom javascript -->
<%-partial('../custom/custom_js')%>
